---
layout: post
title:  "01-ElasticSearch 基本概念"
date:   2017-07-26 09:33:29 +0800
categories: [ElasticSearch]
tags: [ElasticSearch]
---
### ElasticSearch 是什么？
ElasticSearch 是一个准实时的搜索框架,之所以说它是准实时，是因为当你索引一个文档到这个文档可以被搜索,它会有一点延迟（通常有1秒左右）。

### Cluster(集群)
集群一个或者多个节点（或者服务器）的集合，它们共同保存整个数据，并在所有节点上提供联合索引和搜索功能。集合是通过一个唯一的集合名称进行区分的。一个节点可以通过设置集合名称来加入这个集合.

因此我们不能在不同的环境中共享同一个集群名称，例如我们有一个包含所有文章的集群，在开发环境可以明名为 `posts-dev`,在测试环境可以为`posts-qa`,生产为`posts-prod`这样是很容易辨识的。

一个集群允许只有一个节点（不一定非得是多个节点）。

### Node(节点)
节点是集群种的一台服务器，存节点储了数据，并参与集群的索引和搜索功能。和集群一样，节点也是按照名称区分。每个节点在启动的时候默认会随机分配一个由UUID组成的名字。如果你不想使用默认生成的名字，你可以自定义节点的名字。节点的名字跟集群的名字一样，一个有意义的名字可以使得管理员明确的知道节点的相关信息，在出问题的时候更好的定位和解决问题。

一个节点可以通过指定集群名称来假如对应的集群，节点默认的集群名是*elasticsearch*

在一个集群里，可以有很多个节点。但是如果你当前节点是集群中第一启动的节点。那么集群名称就是这个节点设置的集群名称。
### Index（索引）
索引是一些拥有相似特性的文档的集合，类似与数据库. Index通过名称（必须全部是小写），该名称用于在针对其中的文档执行索引，搜索，更新和删除操作时引用索引。
### Type
在索引中，您可以定义一个或多个类型。 类型是您的索引的逻辑类别/分区，其语义完全取决于您。通常，一个Type定义了文档一系列通用的属性。例如我们有一个博客的索引，我们可能需要建立三个type，一个用来表示文章，一个用来表示用户，一个用来表示评论。
### Document
文档是可以被索引的最小单元。例如一篇文章就是一个文档，一个用户也是一个文档。尽管一个文档物理上位于索引种。但是文档必须被分配给索引中的类型（type）进行索引。

### Shards & Replicas（分片和副本）
#### **Shards 分片**
为了使得一个索引可以存储超过单个节点磁盘容量的数据，Elasticsearch 提供了一种技术可以把索引划分位很多份，这其中的一份被称之为一个Shard。当你创建一个索引的时候，你可以指定你需要创建几个分片。每个分片自身是功能完整的独立索引，他们可以可以被部署在集群的node之上。

分片只所以重要的两个主要原因：
- 它允许你水平分割你的内容。例如你有10TB的索引，但是没有一个10TB的硬盘，那么你可以将这些内容放在20个Shard上，每个shard只要能存放500G即可
- 它允许你分布式并行跨分片进行操作，这样的好处是增加吞吐量。

分片如何分布以及搜索到分散在分片上的内容如何被汇总到搜索请求是完全由Elasticsearch控制的，并且对用户是透明的。

#### **Replicas 副本**
在网络环境下，单个节点机器随时都可能发生这样那样的故障，那么一种行之有效的故障转移机制显得就非常重要。Elasticsearch 通过副本（replicas）来解决这个问题，简单的来说，副本就是把节点上的数据复制几份分别放在不同的节点，当其中某个节点遇到问题，别的节点还是可用的。从而保证了数据的完整以及系统的正常工作。

副本之所以重要的两个原因：
- 在一个分片或者node出现故障的情况下，副本保证了高可用性。这也是为什么，副本不要放在同一个节点或者同一个机器上的主要原因。
- 它允许您扩展搜索量/吞吐量，因为可以对所有副本并行执行搜索。


**总结**

一个索引可以被分成多个分片，索引也可以被复制为零（意味着没有副本）或更多次。一旦被复制，每个索引将会有一个主分片和副本。副本和分片的数量可以在index创建的时候指定。索引创建后，你可以更改副本的数量但是不能更改分片的数量

默认Elasticsearch有5个主分片和一个副本

关于索引和分类型（Type）的区别，请参考： [Index vs. Type](https://www.elastic.co/blog/index-vs-type)




